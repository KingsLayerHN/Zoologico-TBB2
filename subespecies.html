<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Zoologico</title>
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body class="auth">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="usuarios.html">Usuario</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="animales.html">Animales</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="especies.html">Especies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="subespecies.html">Subespecies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="habitad.html">Habitad</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="zonas.html">Zonas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="empleados.html">Empleados</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="veterinarios.html">Veterinarios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cuidadores.html">Cuidadores</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mantenimientozonas.html">Mantenimento Zonas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="historialalimenticio.html">Historial Alimenticio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="historialmedico.html">Historial Medico</a>
                    </li>
                </ul>
            </div>
        </nav>
        <button type="button" class="btn btn-success" data-target="#subespeciesModal"
            data-toggle="modal">Agregar</button>
        <button type="button" class="btn btn-dark" disabled="true">Modificar</button>
        <button type="button" class="btn btn-danger" disabled="true">Eliminar</button>
        <table class="table" id="subespecie_table">
            <thead class="thead-dark">
                <tr>
                    <th>No</th>
                    <th>Nombre</th>
                    <th>Especie</th>
                </tr>
            </thead>
            <tbody class="tbody">

            </tbody>
        </table>


        <!-- Modal -->
        <div class="modal fade" id="subespeciesModal" tabindex="-1" role="dialog"
            aria-labelledby="subespeciesModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="subespeciesModalLabel">Sub Especies</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="claven">Clave de subespecie</label>
                                <input type="text" class="form-control" id="claven"  placeholder="Ingrese la calve de sub-especie ">
                            </div>
                            <div class="form-group">
                                <label for="especie">Especie animal</label>
                                <select class="form-control" id="especie">
                                    <option value="">Seleccione una opcion</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="subespecie">Sub-especie del animal</label>
                                <input type="text" class="form-control" id="subespecie"  placeholder="Ingrese la sub-especie animal">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="rellenar()">Rellenar</button>
                        <button type="button" class="btn btn-primary" onclick="delete_subespecie()">Eliminar</button>
                        <button type="button" class="btn btn-primary" onclick="update_subespecie()">Modificar</button>
                        <button type="button" class="btn btn-primary" onclick="save_subespecie()">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-firestore.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDJVpKYgXFURDuuuvn8XITBlcGMn1UmC_M",
            authDomain: "users-7557f.firebaseapp.com",
            databaseURL: "https://users-7557f.firebaseio.com",
            projectId: "users-7557f",
            storageBucket: "users-7557f.appspot.com",
            messagingSenderId: "207944477105",
            appId: "1:207944477105:web:15796ceb1ae54bb8"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <script>
        var table = document.getElementById('subespecie_table').getElementsByTagName('tbody')[0] // Tabla de datos
        let firestore = firebase.firestore();
        firestore.collection('subespecie').get().then(data => {
            data.docs.forEach(function (doc, index) {
                let subespecie = doc.data();
                //console.log(user);
                var row = table.insertRow();
                row.key=doc.id;
                // console.log(row.key);
                add_cell(row, doc.id);
                add_cell(row, subespecie.subespecie);
                add_cell(row, subespecie.especie);              
            });
        }) 
        firestore.collection('especie').get().then(data => {
            data.docs.forEach(function (doc, index) {
                let especie = doc.data();
                //console.log(user);
                var x = document.getElementById("especie");
                var option = document.createElement("option");
                option.text = especie.especie;
                option.value= especie.especie;
                x.add(option);
            
            });
        })
        function add_cell (tr, text) {
            var td = tr.insertCell();
            td.textContent = text;
            return td;
        }   
    </script>
    <script>
        function rellenar(){
            if(document.getElementById('claven').value){
                var myclave=document.getElementById('claven').value;
                var docRef = db.collection("subespecie").doc(myclave);
                docRef.get().then(function(doc) {
                    if (doc.exists) {
                        let subespecie=doc.data();
                        document.getElementById('subespecie').value = subespecie.subespecie;
                        document.getElementById('especie').value=subespecie.especie;
                        console.log("Document data:", doc.data());
                    } else {
                        // doc.data() will be undefined in this case
                        console.log("No such document!");
                    }
                }).catch(function(error) {
                    console.log("Error getting document:", error);
                });
            }else{
                alert("Debe porporcionar una clave valida para rellenar los campos");
            }
        }
        function save_subespecie(){
            alert("entro");
            let subespecie=document.getElementById('subespecie').value;
            let especie=document.getElementById('especie').value;
            db.collection("subespecie").add({
                especie,
                subespecie
            })
            .then(function(docRef) {
                
                console.log("Document written with ID: ", docRef.id);
                alert("Sub-especie registrada")
                document.getElementById('subespecie').value = "";
        
            })
            .catch(function(error) {
                console.error("Error adding document: ", error);
            });
            
        }
        function update_subespecie(){
            if(document.getElementById('claven').value){
                let subespecie=document.getElementById('subespecie').value;
                let clave=document.getElementById('claven').value;
                let especie=document.getElementById('especie').value;
                var washingtonRef = db.collection("subespecie").doc(clave);

                // Set the "especie" field of the city 'DC'
                return washingtonRef.update({
                    especie,
                    subespecie
                })
                .then(function() {
                    console.log("Document successfully updated!");
                    alert("Subespecie actualizada")
                    document.getElementById('claven').value = "";
                    document.getElementById('especie').value = "";
                })
                .catch(function(error) {
                    // The document probably doesn't exist.
                    console.error("Error updating document: ", error);
                });
            }else{
                alert("Ingrese clave para modificar wey")
            }
        }
        function delete_subespecie(){
            if(document.getElementById('claven').value){
                var myclave=document.getElementById('claven').value;

                db.collection("subespecie").doc(myclave).delete().then(function() {
                    alert("El registro de subespecie ha sido eliminado, refresca la pagina");
                    console.log("Document successfully deleted!");
                }).catch(function(error) {
                    console.error("Error removing document: ", error);
                });
            }else{
                alert("Ingrese clave para eliminar wey")
            }
        }
    </script>
        

    <script src="./js/users.js"></script>
</body>

</html>